collectors:
  docker:
    enabled: false
  containerd:
    socket: /run/k3s/containerd/containerd.sock
falco: 
  grpc_output:
    enabled: true
falcosidekick: 
  enabled: true 
  config:
    rabbitmq:
      url: amqp://ztrke2:ztrke2@10.1.1.243:5673
      queue: "events"
tty: true 

customRules:
  falco-test.yaml: |-
    - list: http-l
      items: [lstat, futex, getppid, set_tid_address, setgid, 
            statfs, fchdir, keyctl, accept, access, 
            arch_prctl, capget, capset, exit_group, mkdirat, 
            munmap, nanosleep, sched_yield, setsockopt, madvise, 
            umount2, unshare, close, recvfrom, rt_sigprocmask, 
            shutdown, epoll_ctl, getsockname, stat, brk, 
            getuid, socket, unlink, unlinkat, symlinkat, 
            sigaltstack, chdir, connect, execve, faccessat2, 
            fchownat, lseek, fstat, getcwd, bind, 
            mmap, ppoll, recvmsg, setsid, setuid, 
            rt_sigreturn, sysinfo, write, getegid, getrlimit, 
            mknodat, mount, pipe2, tgkill, dup3, 
            listen, pivot_root, pread64, close_range, getdents64, 
            geteuid, getrandom, mprotect, setitimer, epoll_create1, 
            getpid, rseq, set_robust_list, clone, getgid, 
            gettid, setgroups, sched_getaffinity, openat, sendto, 
            epoll_pwait, fstatfs, ioctl, readlinkat, prlimit64, 
            umask, fcntl, read, rt_sigaction, select, 
            newfstatat, prctl ]

    - list: sql-l
      items: [clock_gettime, clone, fstat, munmap, sysinfo, 
            dup2, eventfd2, getpgrp, symlinkat, newfstatat, 
            brk, fadvise64, mmap, pwrite64, sched_getaffinity, 
            write, getrandom, prlimit64, unlink, capget, 
            pipe2, set_tid_address, poll, exit_group, rename, 
            pread64, arch_prctl, geteuid, close, fallocate, 
            getegid, sched_setaffinity, shutdown, connect, getpriority, 
            epoll_wait, futex, getgid, listen, getcwd, 
            getpeername, getrusage, gettid, getgroups, bind, 
            nanosleep, statfs, openat, prctl, fchdir, 
            fstatfs, clone3, sendto, setsockopt, execve, 
            exit, lseek, faccessat2, ioctl, setgroups, 
            times, uname, mkdir, io_submit, read, 
            access, chdir, fsync, io_setup, madvise, 
            setpriority, fcntl, getppid, clock_nanosleep, mprotect, 
            set_robust_list, capset, epoll_pwait, pipe, setuid, 
            dup, getdents64, getuid, setgid, sigaltstack, 
            wait4, accept, readlink, rt_sigreturn, getpid, 
            socket, sched_yield, epoll_ctl, umask, ppoll, 
            rt_sigaction, io_getevents, recvfrom, renameat, rt_sigtimedwait, 
            fdatasync, rseq, rt_sigprocmask, epoll_create1, tgkill ]

    - list: ssh-l
      items: [chroot, getdents64, getgroups, lseek, prlimit64, 
            setresgid, socketpair, ftruncate, setgid, uname, 
            nanosleep, dup2, fstatfs, bind, clock_nanosleep, 
            wait4, accept, arch_prctl, getcwd, getegid, 
            keyctl, pipe2, set_robust_list, chdir, mmap, 
            pread64, rt_sigprocmask, setpriority, socket, capset, 
            fcntl, getrandom, tgkill, access, faccessat2, 
            getgid, ppoll, sendto, close_range, connect, 
            execve, getpgrp, read, rename, setgroups, 
            umask, vfork, clone, geteuid, getpriority, 
            ioctl, mkdir, munmap, openat, rt_sigaction, 
            set_tid_address, clone3, exit_group, statfs, brk, 
            close, recvmsg, rseq, listen, fstat, 
            getppid, getsockname, mprotect, setsid, write, 
            epoll_pwait, futex, getsockopt, newfstatat, rt_sigreturn, 
            setuid, capget, getpeername, prctl, recvfrom, 
            epoll_ctl, alarm, getpid, getuid, poll, 
            readlink, setresuid, setsockopt, statx ]

    - rule: http-r 
      desc: notice abnormal syscall in http
      condition: > 
        syscall.type != null and
        not syscall.type in (http-l) and evt.dir = >
        and container.id != host and 
        container.name = "http" and 
        container.duration > 60000000000
      output: > 
        | http | %container.image | %k8s.pod.name | %proc.pid
        |SYSCALLTYPE %syscall.type DONE| %container.duration | %evt.rawtime.s
		| %evt.rawtime.ns | %evt.rawtime
      priority: ALERT


    - rule: sql-r 
      desc: notice abnormal syscall in sql
      condition: > 
        syscall.type != null and
        not syscall.type in (sql-l) and evt.dir = >
        and container.id != host and 
        container.name = "sql" and 
        container.duration > 60000000000
      output: > 
        | sql | %container.image | %k8s.pod.name | %proc.pid
        |SYSCALLTYPE %syscall.type DONE| %container.duration | %evt.rawtime.s
		| %evt.rawtime.ns | %evt.rawtime
      priority: ALERT


    - rule: ssh-r 
      desc: notice abnormal syscall in ssh
      condition: > 
        syscall.type != null and
        not syscall.type in (ssh-l) and evt.dir = >
        and container.id != host and 
        container.name = "ssh" and 
        container.duration > 60000000000
      output: > 
        | ssh | %container.image | %k8s.pod.name | %proc.pid
        |SYSCALLTYPE %syscall.type DONE| %container.duration | %evt.rawtime.s
		| %evt.rawtime.ns | %evt.rawtime
      priority: ALERT

