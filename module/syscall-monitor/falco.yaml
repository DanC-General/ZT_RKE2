collectors:
  docker:
    enabled: false
  containerd:
    socket: /run/k3s/containerd/containerd.sock
falco: 
  grpc_output:
    enabled: true
falcosidekick: 
  enabled: true 
  config:
    rabbitmq:
      url: amqp://ztrke2:ztrke2@10.1.1.241:5673
      queue: "events"
tty: true 

customRules:
  falco-test.yaml: |-
    - list: sql-l
      items: [ kill, access, connect, setgroups, wait4, faccessat2, 
            read, recvfrom, futex, mmap, rt_sigprocmask, 
            fadvise64, getrandom, bind, fsync, ioctl, 
            arch_prctl, brk, geteuid, sched_getaffinity, setsockopt, 
            eventfd2, prlimit64, gettid, mprotect, rseq, 
            epoll_wait, shutdown, rt_sigreturn, capset, epoll_ctl, 
            accept, readlink, chdir, sendto, clone, 
            rt_sigaction, getgid, umask, getpeername, lseek, 
            exit_group, openat, fstat, pipe2, getegid, 
            getgroups, clone3, pwrite64, getdents64, getpgrp, 
            io_setup, socket, getrusage, io_getevents, poll, 
            prctl, dup, setgid, exit, set_tid_address, 
            symlinkat, tgkill, io_submit, capget, epoll_pwait, 
            munmap, clock_nanosleep, ppoll, setpriority, sigaltstack, 
            pread64, execve, mkdir, epoll_create1, getpriority, 
            write, statfs, sysinfo, setuid, getcwd, 
            madvise, rename, rt_sigtimedwait, uname, fcntl, 
            getuid, listen, clock_gettime, fstatfs, fdatasync, 
            sched_setaffinity, times, newfstatat, fchdir, sched_yield, 
            nanosleep, pipe, fallocate, getppid, renameat, 
            close, set_robust_list, dup2, getpid, unlink ]

    - list: ssh-l
      items: [ kill, brk, dup2, exit_group, rename, faccessat2, 
            getpgrp, getpid, getuid, pipe2, getppid, 
            capset, fchdir, fchmodat, fsetxattr, accept, 
            getrandom, rseq, fadvise64, sigaltstack, alarm, 
            close_range, execve, munmap, setsockopt, prlimit64, 
            vfork, bind, getpeername, getpriority, getsockopt, 
            poll, pread64, tgkill, unlinkat, utimensat, 
            ftruncate, futex, ioctl, lseek, mmap, 
            renameat2, clone, fstat, capget, statx, 
            chroot, close, fcntl, getcwd, getgroups, 
            setresgid, sendto, set_robust_list, arch_prctl, keyctl, 
            mkdir, newfstatat, openat, rt_sigaction, setgid, 
            write, epoll_ctl, read, recvfrom, sysinfo, 
            copy_file_range, dup, access, clone3, connect, 
            readlink, setsid, wait4, sched_getaffinity, clock_nanosleep, 
            getdents64, setpriority, socket, uname, recvmsg, 
            setgroups, setresuid, statfs, fchown, fstatfs, 
            fgetxattr, getegid, ppoll, prctl, set_tid_address, 
            socketpair, epoll_pwait, rt_sigreturn, setuid, chdir, 
            geteuid, getgid, getsockname, mprotect, rt_sigprocmask, 
            umask, listen, nanosleep ]

    - list: http-l
      items: [ kill, listen, lseek, mmap, set_robust_list, mkdirat, 
            lstat, epoll_pwait, getpid, statfs, execve, 
            clone, recvmsg, getegid, setgid, getsockname, 
            rseq, accept, select, getdents64, epoll_ctl, 
            faccessat2, ppoll, setsockopt, sigaltstack, write, 
            arch_prctl, prctl, futex, mprotect, newfstatat, 
            read, shutdown, stat, exit_group, madvise, 
            setsid, fstat, capset, getrandom, setuid, 
            unlinkat, close, getgid, prlimit64, socket, 
            tgkill, gettid, sched_yield, setitimer, ioctl, 
            munmap, nanosleep, getrlimit, pread64, set_tid_address, 
            dup3, sched_getaffinity, openat, rt_sigprocmask, access, 
            pivot_root, umask, umount2, unshare, getcwd, 
            brk, fchownat, sysinfo, close_range, fchdir, 
            keyctl, symlinkat, fcntl, fstatfs, rt_sigreturn, 
            mknodat, pipe2, geteuid, getuid, connect, 
            capget, getppid, epoll_create1, mount, readlinkat, 
            chdir, rt_sigaction, sendto, unlink, recvfrom, 
            bind, setgroups ]

    - rule: sql-r 
      desc: notice abnormal syscall in sql
      condition: > 
        syscall.type != null and
        not syscall.type in (sql-l) and evt.dir = >
        and container.id != host and 
        container.name = "sql" and 
        container.duration > 60000000000
      output: > 
        | sql | %container.image | %k8s.pod.name | %proc.pid
        |SYSCALLTYPE %syscall.type DONE| %container.duration | %evt.rawtime.s
        | %evt.rawtime.ns | %evt.rawtime
      priority: ALERT


    - rule: ssh-r 
      desc: notice abnormal syscall in ssh
      condition: > 
        syscall.type != null and
        not syscall.type in (ssh-l) and evt.dir = >
        and container.id != host and 
        container.name = "ssh" and 
        container.duration > 60000000000
      output: > 
        | ssh | %container.image | %k8s.pod.name | %proc.pid
        |SYSCALLTYPE %syscall.type DONE| %container.duration | %evt.rawtime.s
        | %evt.rawtime.ns | %evt.rawtime
      priority: ALERT


    - rule: http-r 
      desc: notice abnormal syscall in http
      condition: > 
        syscall.type != null and
        not syscall.type in (http-l) and evt.dir = >
        and container.id != host and 
        container.name = "http" and 
        container.duration > 60000000000
      output: > 
        | http | %container.image | %k8s.pod.name | %proc.pid
        |SYSCALLTYPE %syscall.type DONE| %container.duration | %evt.rawtime.s
        | %evt.rawtime.ns | %evt.rawtime
      priority: ALERT

