collectors:
  docker:
    enabled: false
  containerd:
    socket: /run/k3s/containerd/containerd.sock
falco: 
  grpc_output:
    enabled: true
falcosidekick: 
  enabled: true 
  config:
    rabbitmq:
      url: amqp://ztrke2:ztrke2@10.1.1.241:5673
      queue: "events"
tty: true 

customRules:
  falco-test.yaml: |-
    - list: http-l
      items: [ kill, prlimit, pselect6, setpgid, recvfrom, getrandom, ioctl, sysinfo, fchownat, 
            statfs, umount2, bind, capset, prctl, 
            setuid, tgkill, mknodat, chdir, fstatfs, 
            futex, set_tid_address, madvise, unshare, pipe2, 
            readlinkat, openat, rt_sigaction, select, setitimer, 
            execve, mkdirat, write, listen, newfstatat, 
            rt_sigreturn, epoll_create1, lstat, read, connect, 
            getrlimit, setsid, epoll_pwait, getppid, set_robust_list, 
            clone, sendto, stat, brk, getpid, 
            sched_getaffinity, mmap, getsockname, setgid, sigaltstack, 
            recvmsg, fcntl, getcwd, epoll_ctl, lseek, 
            munmap, nanosleep, capget, getdents64, getgid, 
            gettid, mount, setgroups, setsockopt, dup3, 
            unlinkat, access, mprotect, fchdir, sched_yield, 
            symlinkat, umask, close_range, keyctl, accept, 
            close, arch_prctl, faccessat2, geteuid, prlimit64, 
            pread64, unlink, exit_group, pivot_root, fstat, 
            rt_sigprocmask, shutdown, getegid, getuid, socket, 
            ppoll, rseq ]

    - list: sql-l
      items: [ kill, prlimit, pselect6, setpgid, sysinfo, capset, pipe2, rseq, connect, 
            execve, statfs, clock_gettime, getdents64, prlimit64, 
            sched_setaffinity, getrusage, io_submit, prctl, bind, 
            socket, clone, read, epoll_ctl, exit, 
            clone3, ppoll, getgid, rename, setuid, 
            write, fchdir, getegid, geteuid, mkdir, 
            close, gettid, sched_yield, shutdown, nanosleep, 
            openat, madvise, munmap, faccessat2, getcwd, 
            rt_sigprocmask, getpgrp, setsockopt, access, setgroups, 
            epoll_pwait, umask, getpeername, times, unlink, 
            rt_sigtimedwait, tgkill, set_robust_list, eventfd2, fsync, 
            getrandom, setpriority, fallocate, io_setup, listen, 
            pipe, newfstatat, arch_prctl, sigaltstack, clock_nanosleep, 
            fdatasync, readlink, fadvise64, fstatfs, rt_sigaction, 
            getpid, sendto, getuid, renameat, symlinkat, 
            epoll_wait, mmap, brk, getppid, capget, 
            chdir, setgid, ioctl, io_getevents, poll, 
            dup2, fstat, pwrite64, recvfrom, fcntl, 
            mprotect, pread64, sched_getaffinity, exit_group, rt_sigreturn, 
            wait4, accept, lseek, set_tid_address, epoll_create1, 
            futex, dup, uname, getgroups, getpriority ]

    - list: ssh-l
      items: [ kill, prlimit, pselect6, setpgid, socketpair, uname, copy_file_range, dup, exit_group, 
            getrandom, pipe2, setgid, unlinkat, setsockopt, 
            fstatfs, getpriority, openat, prctl, recvfrom, 
            access, rt_sigprocmask, set_tid_address, utimensat, mprotect, 
            readlink, statx, umask, capget, getpgrp, 
            ioctl, mkdir, setuid, rt_sigreturn, setgroups, 
            fchdir, clone3, getpeername, prlimit64, read, 
            newfstatat, ppoll, recvmsg, set_robust_list, close_range, 
            getpid, getsockopt, munmap, setresuid, setsid, 
            capset, sigaltstack, sysinfo, poll, pread64, 
            epoll_pwait, tgkill, socket, chdir, chroot, 
            execve, rseq, write, nanosleep, brk, 
            connect, lseek, mmap, rt_sigaction, sendto, 
            vfork, bind, clock_nanosleep, clone, rename, 
            listen, fchown, fgetxattr, getppid, fchmodat, 
            close, getdents64, getgid, getgroups, setresgid, 
            epoll_ctl, fadvise64, arch_prctl, futex, getcwd, 
            keyctl, wait4, sched_getaffinity, dup2, getegid, 
            getsockname, statfs, fstat, ftruncate, geteuid, 
            getuid, accept, alarm, faccessat2, fcntl, 
            setpriority, fsetxattr, renameat2 ]

    - rule: http-r 
      desc: notice abnormal syscall in http
      condition: > 
        syscall.type != null and
        not syscall.type in (http-l) and evt.dir = >
        and container.id != host and 
        container.name = "http" and 
        container.duration > 60000000000
      output: > 
        | http | %container.image | %k8s.pod.name | %proc.pid
        |SYSCALLTYPE %syscall.type DONE| %container.duration | %evt.rawtime.s
        | %evt.rawtime.ns | %evt.rawtime
      priority: ALERT


    - rule: sql-r 
      desc: notice abnormal syscall in sql
      condition: > 
        syscall.type != null and
        not syscall.type in (sql-l) and evt.dir = >
        and container.id != host and 
        container.name = "sql" and 
        container.duration > 60000000000
      output: > 
        | sql | %container.image | %k8s.pod.name | %proc.pid
        |SYSCALLTYPE %syscall.type DONE| %container.duration | %evt.rawtime.s
        | %evt.rawtime.ns | %evt.rawtime
      priority: ALERT


    - rule: ssh-r 
      desc: notice abnormal syscall in ssh
      condition: > 
        syscall.type != null and
        not syscall.type in (ssh-l) and evt.dir = >
        and container.id != host and 
        container.name = "ssh" and 
        container.duration > 60000000000
      output: > 
        | ssh | %container.image | %k8s.pod.name | %proc.pid
        |SYSCALLTYPE %syscall.type DONE| %container.duration | %evt.rawtime.s
        | %evt.rawtime.ns | %evt.rawtime
      priority: ALERT

